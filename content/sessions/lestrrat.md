---
key: lestrrat
title: GoらしいAPIを求める旅路 並行処理編
id: lestrrat
format: conference
talkType: short_session
level: Intermediate
tags: []
speakers:
- lestrrat
videoId: null
presentation: null
draft: false
---
Goではユーザは簡単にgoroutineを作成して使用することができます。
逆にライブラリ提供者はオブジェクトを提供した際にどのメソッドでも簡単に`go`キーワードをつけて実行されることを意識しないといけません。

このトークでは「Goらしく」そしてさらに「並行処理を意識した」APIを備えたライブラリのデザインをする際に考えることなどを紹介します。
---
ライブラリコードを一度提供してしまうと、それをユーザがどう使うかは提供者側はほとんどコントロールできません。
やってはいけないという指示をドキュメントに書いてもユーザはドキュメントを読みませんし、
思い違いで間違った使い方をすることもあります。

通常の使い方でもこのようなことは起こりうるのに、Goではどのメソッドでも簡単にgoキーワードで並行実行が可能となって
しまいます。つまり、意図していないメソッドでも並行実行される可能性があるわけです。それとは別に、パフォーマンスのため
にライブラリ側から意図的に並行実行を促したいメソッドもあるでしょう。

このトークは基本的にこれらの前提をもとに、どのようにして正しく動作するだけでなくよりGoらしいライブラリAPIを提供するか、という点について解説します。

具体的には
* 排他処理を必要としないgoroutineごとのステート管理のパターン
* context.Contextを含むメソッド引数の考え方
* 呼び出し元との交信方法
* それでも必要となった場合の排他処理
のについて解説しつつ、GoらしいAPIをデザインする考え方について語ります

